<script lang="ts">
	import { cn } from '$lib/cn';
	import type { SVGAttributes } from 'svelte/elements';

	let {
		beat,
		playing,
		...props
	}: SVGAttributes<SVGSVGElement> & { beat: number; playing: boolean } = $props();

	let jsp = $derived(beat - 1);
	let kAnimationStep: 'fw' | 'bw' | 'nm' = $derived(
		playing && beat > 0 ? (+(jsp % 2 === Math.floor(jsp / 16) % 2) ? 'fw' : 'bw') : 'nm'
	);
	let eStep: 'fw' | 'bw' | 'nm' = $derived(
		playing && beat > 16 ? (+(jsp % 2 === Math.floor(jsp / 16) % 2) ? 'fw' : 'bw') : 'nm'
	);
	let eStep2: 'fw' | 'bw' | 'nm' = $derived(
		playing && beat > 32 ? (+(jsp % 2 === Math.floor(jsp / 16) % 2) ? 'fw' : 'bw') : 'nm'
	);
	let animatePA = $derived(playing && beat > 32);
</script>

<svg
	viewBox="0 0 127 54"
	fill="none"
	xmlns="http://www.w3.org/2000/svg"
	{...props}
	class={cn('overflow-visible', props.class)}
>
	<!-- k -->
	<path
		d="M4.91999 42C2.73294 42 0.959991 40.2271 0.959991 38.04V3.96C0.959991 1.77295 2.73294 0 4.91999 0V0C7.10704 0 8.87999 1.77295 8.87999 3.96V15.9475C8.87999 16.3521 9.20793 16.68 9.61245 16.68V16.68C9.83239 16.68 10.0407 16.5812 10.1798 16.4108L22.4234 1.41647C23.1553 0.520051 24.2514 0 25.4087 0V0C28.6902 0 30.4705 3.83927 28.3505 6.34404L18.9409 17.4615C17.3599 19.3296 17.3633 22.0675 18.9491 23.9316L28.7717 35.478C30.9581 38.0481 29.1316 42 25.7573 42V42C24.5692 42 23.444 41.4663 22.6923 40.5461L10.1798 25.2291C10.0407 25.0588 9.83242 24.96 9.61252 24.96V24.96C9.20796 24.96 8.87999 25.288 8.87999 25.6925V38.04C8.87999 40.2271 7.10704 42 4.91999 42V42Z"
		fill="#5B36C2"
		class={cn(
			'origin-left transition-transform duration-75',
			kAnimationStep === 'fw' && 'rotate-12',
			kAnimationStep === 'bw' && '-rotate-12',
			kAnimationStep === 'nm' && 'rotate-0'
		)}
	/>
	<!-- e -->
	<path
		d="M46.6397 42.84C43.6797 42.84 41.0597 42.22 38.7797 40.98C36.5397 39.7 34.7797 37.92 33.4997 35.64C32.2597 33.32 31.6397 30.6 31.6397 27.48V26.76C31.6397 23.64 32.2597 20.94 33.4997 18.66C34.7397 16.34 36.4797 14.56 38.7197 13.32C40.9597 12.04 43.5597 11.4 46.5197 11.4C49.4397 11.4 51.9797 12.06 54.1397 13.38C56.2997 14.66 57.9797 16.46 59.1797 18.78C60.3797 21.06 60.9797 23.72 60.9797 26.76V26.76C60.9797 28.1849 59.8246 29.34 58.3997 29.34H40.3597C39.792 29.34 39.3306 29.8143 39.4239 30.3743C39.6859 31.9484 40.4112 33.2636 41.5997 34.32C43.0397 35.6 44.7997 36.24 46.8797 36.24C48.9997 36.24 50.5597 35.78 51.5597 34.86C51.8065 34.633 52.0386 34.3999 52.2562 34.1606C53.3012 33.0115 54.9913 32.4038 56.367 33.125V33.125C58.3777 34.1792 59.1091 36.6699 57.6234 38.3866C57.6023 38.411 57.581 38.4355 57.5597 38.46C56.5197 39.66 55.1197 40.7 53.3597 41.58C51.5997 42.42 49.3597 42.84 46.6397 42.84ZM39.6493 22.5563C39.4635 23.144 39.9392 23.7 40.5556 23.7H52.2023C52.7912 23.7 53.261 23.19 53.1169 22.6191C52.8072 21.392 52.1682 20.3723 51.1997 19.56C49.9997 18.52 48.4197 18 46.4597 18C44.4197 18 42.7997 18.52 41.5997 19.56C40.6785 20.3584 40.0283 21.3571 39.6493 22.5563Z"
		fill="#5B36C2"
		class={cn(
			'origin-[25%] transition-transform duration-75',
			eStep === 'fw' && 'scale-y-75',
			eStep === 'bw' && 'scale-y-125',
			eStep === 'nm' && 'scale-y-100',
			eStep2 === 'fw' && 'translate-x-1/12',
			eStep2 === 'bw' && '-translate-x-0',
			eStep2 === 'nm' && 'translate-x-0'
		)}
	/>
	<!-- p -->
	<path
		d="M66.6886 54C64.601 54 62.9086 52.3076 62.9086 50.22V15.96C62.9086 13.9055 64.5741 12.24 66.6286 12.24H67.3486C69.0054 12.24 70.3486 13.5831 70.3486 15.24V15.24C70.3486 15.5714 70.6172 15.84 70.9486 15.84H71.0352C71.2789 15.84 71.5021 15.7094 71.6371 15.5065C72.3177 14.4835 73.3082 13.5747 74.6086 12.78C76.0486 11.86 78.1086 11.4 80.7886 11.4C83.1886 11.4 85.4086 12 87.4486 13.2C89.4886 14.36 91.1286 16.08 92.3686 18.36C93.6086 20.64 94.2286 23.4 94.2286 26.64V27.6C94.2286 30.84 93.6086 33.6 92.3686 35.88C91.1286 38.16 89.4886 39.9 87.4486 41.1C85.4086 42.26 83.1886 42.84 80.7886 42.84C78.9886 42.84 77.4686 42.62 76.2286 42.18C75.0286 41.78 74.0486 41.26 73.2886 40.62C72.6797 40.0449 72.1709 39.4699 71.7623 38.8948C71.6248 38.7014 71.4053 38.58 71.1681 38.58V38.58C70.7818 38.58 70.4686 38.8932 70.4686 39.2795V50.22C70.4686 52.3076 68.7762 54 66.6886 54V54ZM78.5086 36.24C80.8686 36.24 82.8086 35.5 84.3286 34.02C85.8886 32.5 86.6686 30.3 86.6686 27.42V26.82C86.6686 23.94 85.8886 21.76 84.3286 20.28C82.7686 18.76 80.8286 18 78.5086 18C76.1886 18 74.2486 18.76 72.6886 20.28C71.1286 21.76 70.3486 23.94 70.3486 26.82V27.42C70.3486 30.3 71.1286 32.5 72.6886 34.02C74.2486 35.5 76.1886 36.24 78.5086 36.24Z"
		fill="#5B36C2"
		class={cn(animatePA && 'rotate-xes')}
	/>
	<!-- a -->
	<g class={cn(animatePA && 'rotate-yes')}>
		<path
			d="M120 30C120 28.3431 121.343 27 123 27V27C124.657 27 126 28.3431 126 30V39C126 40.6569 124.657 42 123 42V42C121.343 42 120 40.6569 120 39V30Z"
			class=""
			fill="#301874"
		/>
		<path
			d="M111.24 11.16C114.2 11.16 116.82 11.78 119.1 13.02C121.34 14.3 123.1 16.08 124.38 18.36C125.62 20.68 126.24 23.4 126.24 26.52V27.24C126.24 30.36 125.62 33.06 124.38 35.34C123.14 37.66 121.4 39.44 119.16 40.68C116.92 41.96 114.32 42.6 111.36 42.6C108.44 42.6 105.9 41.94 103.74 40.62C101.58 39.34 99.9 37.54 98.7 35.22C97.5 32.94 96.9 30.28 96.9 27.24V27.24C96.9 25.8151 98.0551 24.66 99.48 24.66L117.52 24.66C118.088 24.66 118.549 24.1857 118.456 23.6257C118.194 22.0516 117.468 20.7364 116.28 19.68C114.84 18.4 113.08 17.76 111 17.76C108.88 17.76 107.32 18.22 106.32 19.14C106.249 19.2052 106.179 19.2709 106.111 19.3371C104.721 20.6818 102.606 21.4481 100.893 20.5499V20.5499C99.2232 19.6747 98.6063 17.6033 99.8045 16.1482C99.9692 15.9482 100.141 15.7455 100.32 15.54C101.36 14.34 102.76 13.3 104.52 12.42C106.28 11.58 108.52 11.16 111.24 11.16ZM118.23 31.4437C118.416 30.856 117.94 30.3 117.324 30.3L105.677 30.3C105.088 30.3 104.619 30.81 104.763 31.3809C105.072 32.608 105.712 33.6277 106.68 34.44C107.88 35.48 109.46 36 111.42 36C113.46 36 115.08 35.48 116.28 34.44C117.201 33.6416 117.851 32.6429 118.23 31.4437Z"
			fill="#5B36C2"
			class=""
		/>
	</g>
</svg>

<style>
	@keyframes rotate-y-animation {
		from {
			transform: rotateY(0deg);
		}
		to {
			transform: rotateY(360deg);
		}
	}
	.rotate-yes {
		@apply origin-[90%];
		animation: rotate-y-animation 1s infinite linear;
	}
	@keyframes rotate-x-animation {
		from {
			transform: rotateX(0deg);
		}
		to {
			transform: rotateX(360deg);
		}
	}
	.rotate-xes {
		@apply origin-[90%];
		animation: rotate-x-animation 1s infinite linear;
	}
</style>
